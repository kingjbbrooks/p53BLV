#!/usr/local/bin/node

const fs = require('fs')

// utility

const buildPlotX = max_x => Array.from(new Array(max_x), (val, index) => index + 1)

const maxValue = arr => arr.reduce((a, b) => Math.max(a, b))

//////////////////////////////////////////////////////////////

const sequence_info = JSON.parse(fs.readFileSync('../src/seq-info.json', 'utf-8'))

const res = {}

for (let src of fs.readdirSync('../src/NM/')) {
  let data = fs.readFileSync(`../src/NM/${src}`, 'utf-8').split('_')
  let tid = src.match(/^NM_\d+/)[0]

  res[tid] = {
    plot: {
      x: buildPlotX(data.length),
      y: data
    },
    sequence_info: sequence_info[tid],
    stats: {
      max_x: data.length,
      max_y: maxValue(data)
    }
  }
}

fs.writeFileSync('../app/res.json', JSON.stringify(res, null, 2))

// vi:et:ft=javascript
